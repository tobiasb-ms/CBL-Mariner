From 44310b1307b481298dce952741f2ff32be263cdc Mon Sep 17 00:00:00 2001
From: Tomas Mraz <tomas@openssl.org>
Date: Tue, 21 Mar 2023 16:15:47 +0100
Subject: [PATCH] Fix documentation of X509_VERIFY_PARAM_add0_policy()

---
 CHANGES                                  | 5 +++++
 NEWS                                     | 1 +
 doc/man3/X509_VERIFY_PARAM_set_flags.pod | 9 +++++++--
 3 files changed, 13 insertions(+), 2 deletions(-)

Backported by @rohitrawat from upstream on 2023-04-12
Applies on 1.1.1k cleanly

Signed-off-by: Rohit Rawat <xordux@gmail.com>

diff --git a/CHANGES b/CHANGES
index 7d0129e..276ab0e 100644
--- a/CHANGES
+++ b/CHANGES
@@ -9,6 +9,11 @@
 
  Changes between 1.1.1j and 1.1.1k [25 Mar 2021]
 
+  *) Corrected documentation of X509_VERIFY_PARAM_add0_policy() to mention
+     that it does not enable policy checking. Thanks to
+     David Benjamin for discovering this issue. (CVE-2023-0466)
+     [Tomas Mraz]
+
   *) Fixed a problem with verifying a certificate chain when using the
      X509_V_FLAG_X509_STRICT flag. This flag enables additional security checks
      of the certificates present in a certificate chain. It is not set by
diff --git a/NEWS b/NEWS
index 05991a0..771a149 100644
--- a/NEWS
+++ b/NEWS
@@ -7,6 +7,7 @@
 
   Major changes between OpenSSL 1.1.1j and OpenSSL 1.1.1k [25 Mar 2021]
 
+      o Fixed documentation of X509_VERIFY_PARAM_add0_policy() (CVE-2023-0466)
       o Fixed a problem with verifying a certificate chain when using the
         X509_V_FLAG_X509_STRICT flag (CVE-2021-3450)
       o Fixed an issue where an OpenSSL TLS server may crash if sent a
diff --git a/doc/man3/X509_VERIFY_PARAM_set_flags.pod b/doc/man3/X509_VERIFY_PARAM_set_flags.pod
index f6f304b..aa292f9 100644
--- a/doc/man3/X509_VERIFY_PARAM_set_flags.pod
+++ b/doc/man3/X509_VERIFY_PARAM_set_flags.pod
@@ -92,8 +92,9 @@ B<trust>.
 X509_VERIFY_PARAM_set_time() sets the verification time in B<param> to
 B<t>. Normally the current time is used.
 
-X509_VERIFY_PARAM_add0_policy() enables policy checking (it is disabled
-by default) and adds B<policy> to the acceptable policy set.
+X509_VERIFY_PARAM_add0_policy() adds B<policy> to the acceptable policy set.
+Contrary to preexisting documentation of this function it does not enable
+policy checking.
 
 X509_VERIFY_PARAM_set1_policies() enables policy checking (it is disabled
 by default) and sets the acceptable policy set to B<policies>. Any existing
@@ -377,6 +378,10 @@ and has no effect.
 
 The X509_VERIFY_PARAM_get_hostflags() function was added in OpenSSL 1.1.0i.
 
+The function X509_VERIFY_PARAM_add0_policy() was historically documented as
+enabling policy checking however the implementation has never done this.
+The documentation was changed to align with the implementation.
+
 =head1 COPYRIGHT
 
 Copyright 2009-2020 The OpenSSL Project Authors. All Rights Reserved.
-- 
2.17.1

